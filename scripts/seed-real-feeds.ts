import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  console.log('üå± Preparando feeds reais de revistas em An√°lise do Comportamento...')

  // Verifica conex√£o com o banco
  try {
    await prisma.$connect()
    console.log('‚úÖ Conectado ao banco de dados')
  } catch (error) {
    console.log('‚ö†Ô∏è  Banco de dados n√£o dispon√≠vel, listando feeds que seriam adicionados...')
    console.log('')
    listFeedsOnly()
    return
  }
  
  // Primeiro, vamos limpar feeds existentes para evitar duplicatas
  try {
    console.log('üßπ Removendo feeds de exemplo...')
    await prisma.feed.deleteMany({
      where: {
        OR: [
          { name: { contains: 'Journal of Applied Behavior Analysis' } },
          { name: { contains: 'Behavior Analysis in Practice' } },
          { name: { contains: 'Revista Brasileira de An√°lise do Comportamento' } },
          { name: { contains: 'Perspectivas em An√°lise do Comportamento' } },
          { name: { contains: 'The Behavior Analyst' } }
        ]
      }
    })
    console.log('‚úÖ Feeds de exemplo removidos')
  } catch (error: any) {
    console.log('‚ö†Ô∏è  Erro ao remover feeds de exemplo:', error.message)
  }

  // Feeds em Portugu√™s (Brasil)
  console.log('üáßüá∑ Adicionando feeds brasileiros...')
  const brazilianFeeds = [
    {
      name: 'Revista Perspectivas em An√°lise do Comportamento',
      journalName: 'Revista Perspectivas em An√°lise do Comportamento',
      feedUrl: 'https://revistaperspectivas.org/perspectivas/gateway/plugin/WebFeedGatewayPlugin/rss2',
      feedType: 'RSS' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'Behaviorismo Radical / ABA'
    },
    {
      name: 'Revista ESPECTRO (UFSCar)',
      journalName: 'Revista ESPECTRO',
      feedUrl: 'https://www.espectro.ufscar.br/index.php/1979/gateway/plugin/WebFeedGatewayPlugin/rss2',
      feedType: 'RSS2' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'ABA (Autismo)'
    },
    {
      name: 'Boletim Contexto (ABPMC)',
      journalName: 'Boletim Contexto',
      feedUrl: 'https://boletimcontexto.wordpress.com/feed',
      feedType: 'RSS' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'An√°lise do Comportamento (informativo)'
    },
    {
      name: 'Portal Comporte-se',
      journalName: 'Portal Comporte-se',
      feedUrl: 'https://comportese.com/feed',
      feedType: 'RSS' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'An√°lise do Comportamento (divulga√ß√£o)'
    }
  ]

  for (const feedData of brazilianFeeds) {
    try {
      const feed = await prisma.feed.create({
        data: {
          name: feedData.name,
          journalName: feedData.journalName,
          feedUrl: feedData.feedUrl,
          feedType: feedData.feedType,
          country: feedData.country,
          language: feedData.language,
          isActive: true,
          syncFrequency: 3600 // 1 hora
        }
      })
      console.log(`‚úÖ Feed brasileiro criado: ${feed.name}`)
    } catch (error: any) {
      if (error.code === 'P2002') {
        console.log(`‚ö†Ô∏è  Feed j√° existe: ${feedData.name}`)
      } else {
        console.error(`‚ùå Erro ao criar feed ${feedData.name}:`, error.message)
      }
    }
  }

  // Feeds em Ingl√™s (Internacional)
  console.log('üá∫üá∏ Adicionando feeds internacionais...')
  const internationalFeeds = [
    {
      name: 'Journal of Applied Behavior Analysis (JABA)',
      journalName: 'Journal of Applied Behavior Analysis',
      feedUrl: 'https://onlinelibrary.wiley.com/rss/journal/10.1002/(ISSN)1938-3703',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'ABA (experimental aplicada)'
    },
    {
      name: 'Journal of the Experimental Analysis of Behavior (JEAB)',
      journalName: 'Journal of the Experimental Analysis of Behavior',
      feedUrl: 'https://onlinelibrary.wiley.com/rss/journal/10.1002/(ISSN)1938-3711',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'An√°lise Experimental do Comportamento'
    },
    {
      name: 'Journal of Organizational Behavior Management (JOBM)',
      journalName: 'Journal of Organizational Behavior Management',
      feedUrl: 'https://www.tandfonline.com/feed/rss/worg20',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'OBM (Organizational Behavior Management)'
    },
    {
      name: 'Behavior Analysis in Practice (BAP)',
      journalName: 'Behavior Analysis in Practice',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=40617&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'ABA (pr√°tica cl√≠nica)'
    },
    {
      name: 'Perspectives on Behavior Science',
      journalName: 'Perspectives on Behavior Science',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=40614&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'Teoria e Revis√µes'
    },
    {
      name: 'The Analysis of Verbal Behavior (TAVB)',
      journalName: 'The Analysis of Verbal Behavior',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=40616&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'Comportamento Verbal'
    },
    {
      name: 'Behavior and Social Issues (BSI)',
      journalName: 'Behavior and Social Issues',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=42822&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'ABA e quest√µes sociais'
    },
    {
      name: 'OBM Network News (Newsletter)',
      journalName: 'OBM Network News',
      feedUrl: 'http://www.obmnetwork.com/resource/rss/news.rss',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'OBM (informativo institucional)'
    }
  ]

  for (const feedData of internationalFeeds) {
    try {
      const feed = await prisma.feed.create({
        data: {
          name: feedData.name,
          journalName: feedData.journalName,
          feedUrl: feedData.feedUrl,
          feedType: feedData.feedType,
          country: feedData.country,
          language: feedData.language,
          isActive: true,
          syncFrequency: 3600 // 1 hora
        }
      })
      console.log(`‚úÖ Feed internacional criado: ${feed.name}`)
    } catch (error: any) {
      if (error.code === 'P2002') {
        console.log(`‚ö†Ô∏è  Feed j√° existe: ${feedData.name}`)
      } else {
        console.error(`‚ùå Erro ao criar feed ${feedData.name}:`, error.message)
      }
    }
  }

  // Atualizar categorias com cores do tema jornal
  console.log('üé® Atualizando cores das categorias...')
  await prisma.category.updateMany({
    where: { slug: 'terapia-comportamental' },
    data: { color: '#DC2626' } // Red-600
  })
  await prisma.category.updateMany({
    where: { slug: 'analise-experimental' },
    data: { color: '#EA580C' } // Orange-600
  })
  await prisma.category.updateMany({
    where: { slug: 'educacao' },
    data: { color: '#CA8A04' } // Yellow-600
  })
  await prisma.category.updateMany({
    where: { slug: 'clinica' },
    data: { color: '#DC2626' } // Red-600
  })
  await prisma.category.updateMany({
    where: { slug: 'organizacional' },
    data: { color: '#7C3AED' } // Violet-600
  })

  // Adicionar algumas categorias espec√≠ficas para os feeds
  console.log('üìÇ Adicionando categorias espec√≠ficas...')
  const newCategories = [
    {
      name: 'Comportamento Verbal',
      slug: 'comportamento-verbal',
      description: 'An√°lise do comportamento verbal e linguagem',
      color: '#059669' // Emerald-600
    },
    {
      name: 'Quest√µes Sociais',
      slug: 'questoes-sociais',
      description: 'Aplica√ß√µes da ABA em quest√µes sociais e comunit√°rias',
      color: '#2563EB' // Blue-600
    },
    {
      name: 'Autismo',
      slug: 'autismo',
      description: 'Interven√ß√µes comportamentais para transtorno do espectro autista',
      color: '#DB2777' // Pink-600
    },
    {
      name: 'Filosofia Behaviorista',
      slug: 'filosofia-behaviorista',
      description: 'Fundamentos filos√≥ficos da an√°lise do comportamento',
      color: '#7C2D12' // Amber-800
    }
  ]

  for (const categoryData of newCategories) {
    try {
      const category = await prisma.category.create({
        data: categoryData
      })
      console.log(`‚úÖ Categoria criada: ${category.name}`)
    } catch (error: any) {
      if (error.code === 'P2002') {
        console.log(`‚ö†Ô∏è  Categoria j√° existe: ${categoryData.name}`)
      } else {
        console.error(`‚ùå Erro ao criar categoria ${categoryData.name}:`, error.message)
      }
    }
  }

  // Estat√≠sticas finais
  const totalFeeds = await prisma.feed.count()
  const totalCategories = await prisma.category.count()
  const activeFeeds = await prisma.feed.count({ where: { isActive: true } })

  console.log('')
  console.log('üéâ Feeds reais adicionados com sucesso!')
  console.log('')
  console.log('üìä Resumo final:')
  console.log(`  - ${totalFeeds} feeds totais (${activeFeeds} ativos)`)
  console.log(`  - ${brazilianFeeds.length} feeds brasileiros`)
  console.log(`  - ${internationalFeeds.length} feeds internacionais`)
  console.log(`  - ${totalCategories} categorias`)
  console.log('')
  console.log('üöÄ Pr√≥ximos passos:')
  console.log('  - Execute a sincroniza√ß√£o de feeds para buscar artigos')
  console.log('  - Monitore os feeds no painel administrativo')
  console.log('  - Configure a sincroniza√ß√£o autom√°tica via cron jobs')
  console.log('')
  console.log('üì° Feeds adicionados:')
  console.log('  üáßüá∑ Brasileiros:')
  brazilianFeeds.forEach(feed => console.log(`    - ${feed.name}`))
  console.log('  üá∫üá∏ Internacionais:')
  internationalFeeds.forEach(feed => console.log(`    - ${feed.name}`))
}

function listFeedsOnly() {
  // Feeds em Portugu√™s (Brasil)
  const brazilianFeeds = [
    {
      name: 'Revista Perspectivas em An√°lise do Comportamento',
      journalName: 'Revista Perspectivas em An√°lise do Comportamento',
      feedUrl: 'https://revistaperspectivas.org/perspectivas/gateway/plugin/WebFeedGatewayPlugin/rss2',
      feedType: 'RSS' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'Behaviorismo Radical / ABA'
    },
    {
      name: 'Revista ESPECTRO (UFSCar)',
      journalName: 'Revista ESPECTRO',
      feedUrl: 'https://www.espectro.ufscar.br/index.php/1979/gateway/plugin/WebFeedGatewayPlugin/rss2',
      feedType: 'RSS2' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'ABA (Autismo)'
    },
    {
      name: 'Boletim Contexto (ABPMC)',
      journalName: 'Boletim Contexto',
      feedUrl: 'https://boletimcontexto.wordpress.com/feed',
      feedType: 'RSS' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'An√°lise do Comportamento (informativo)'
    },
    {
      name: 'Portal Comporte-se',
      journalName: 'Portal Comporte-se',
      feedUrl: 'https://comportese.com/feed',
      feedType: 'RSS' as const,
      country: 'BR',
      language: 'pt-BR',
      description: 'An√°lise do Comportamento (divulga√ß√£o)'
    }
  ]

  // Feeds em Ingl√™s (Internacional)
  const internationalFeeds = [
    {
      name: 'Journal of Applied Behavior Analysis (JABA)',
      journalName: 'Journal of Applied Behavior Analysis',
      feedUrl: 'https://onlinelibrary.wiley.com/rss/journal/10.1002/(ISSN)1938-3703',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'ABA (experimental aplicada)'
    },
    {
      name: 'Journal of the Experimental Analysis of Behavior (JEAB)',
      journalName: 'Journal of the Experimental Analysis of Behavior',
      feedUrl: 'https://onlinelibrary.wiley.com/rss/journal/10.1002/(ISSN)1938-3711',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'An√°lise Experimental do Comportamento'
    },
    {
      name: 'Journal of Organizational Behavior Management (JOBM)',
      journalName: 'Journal of Organizational Behavior Management',
      feedUrl: 'https://www.tandfonline.com/feed/rss/worg20',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'OBM (Organizational Behavior Management)'
    },
    {
      name: 'Behavior Analysis in Practice (BAP)',
      journalName: 'Behavior Analysis in Practice',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=40617&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'ABA (pr√°tica cl√≠nica)'
    },
    {
      name: 'Perspectives on Behavior Science',
      journalName: 'Perspectives on Behavior Science',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=40614&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'Teoria e Revis√µes'
    },
    {
      name: 'The Analysis of Verbal Behavior (TAVB)',
      journalName: 'The Analysis of Verbal Behavior',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=40616&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'Comportamento Verbal'
    },
    {
      name: 'Behavior and Social Issues (BSI)',
      journalName: 'Behavior and Social Issues',
      feedUrl: 'https://link.springer.com/search.rss?facet-journal-id=42822&facet-content-type=Article',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'ABA e quest√µes sociais'
    },
    {
      name: 'OBM Network News (Newsletter)',
      journalName: 'OBM Network News',
      feedUrl: 'http://www.obmnetwork.com/resource/rss/news.rss',
      feedType: 'RSS' as const,
      country: 'US',
      language: 'en',
      description: 'OBM (informativo institucional)'
    }
  ]

  console.log('üéâ Lista de feeds reais que ser√£o adicionados quando o banco estiver dispon√≠vel!')
  console.log('')
  console.log('üìä Resumo:')
  console.log(`  - ${brazilianFeeds.length + internationalFeeds.length} feeds totais`)
  console.log(`  - ${brazilianFeeds.length} feeds brasileiros`)
  console.log(`  - ${internationalFeeds.length} feeds internacionais`)
  console.log('')
  console.log('üì° Feeds preparados:')
  console.log('  üáßüá∑ Brasileiros:')
  brazilianFeeds.forEach(feed => {
    console.log(`    ‚úÖ ${feed.name}`)
    console.log(`       üì° ${feed.feedUrl}`)
    console.log(`       üìù ${feed.description}`)
    console.log('')
  })
  console.log('  üá∫üá∏ Internacionais:')
  internationalFeeds.forEach(feed => {
    console.log(`    ‚úÖ ${feed.name}`)
    console.log(`       üì° ${feed.feedUrl}`)
    console.log(`       üìù ${feed.description}`)
    console.log('')
  })
  
  console.log('üöÄ Para adicionar os feeds ao banco:')
  console.log('  1. Configure sua DATABASE_URL no arquivo .env')
  console.log('  2. Execute: npm run db:push')
  console.log('  3. Execute: npm run db:seed-feeds')
  console.log('  4. Execute: npm run db:sync (para sincronizar os artigos)')
}

main()
  .catch((e) => {
    console.error('‚ùå Erro durante a adi√ß√£o de feeds:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
